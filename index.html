<!doctype html>
const category=$('#newCategory').value.trim();
const cost_usd=parseFloat($('#newCostUsd').value||'0');
const quantity=parseInt($('#newQty').value||'1',10);
if(!sku||!title||!category){ alert('SKU, Title, Category required'); return; }
try{
const res = await req('/inventory', { method:'POST', body:{ sku, title, category, cost_usd, quantity } });
if(!res.ok) throw new Error(res.error||'create_failed');
$('#newSku').value=''; $('#newTitle').value=''; $('#newCategory').value=''; $('#newCostUsd').value=''; $('#newQty').value='1';
await load();
}catch(e){ alert(e.message); }
});


// --- upload photo (delegated)
$('#grid tbody').addEventListener('change', async (ev)=>{
if(ev.target.classList.contains('uploader')){
const file = ev.target.files?.[0]; if(!file) return;
const id = ev.target.getAttribute('data-id');
const fd = new FormData(); fd.append('file', file, file.name||'upload.png');
try{ await req(`/inventory/${encodeURIComponent(id)}/photo`, { method:'POST', body: fd }); await load(); }
catch(e){ alert(e.message); }
}
});


// --- row buttons (delegated)
$('#grid tbody').addEventListener('click', async (ev)=>{
const btn = ev.target.closest('button'); if(!btn) return;
const id = btn.getAttribute('data-id');
const act = btn.getAttribute('data-act');
try{
if(act==='save'){
const tr = btn.closest('tr'); const patch={};
tr.querySelectorAll('input[data-f],select[data-f]').forEach(el=>{ const k=el.getAttribute('data-f'); let v=el.value; if(k==='cost_cents'||k==='quantity') v=Number(v||0); patch[k]=v; });
await req(`/inventory/${encodeURIComponent(id)}`, { method:'PATCH', body: patch });
await load();
} else if(act==='del'){
if(!confirm('Delete this item?')) return;
await req(`/inventory/${encodeURIComponent(id)}`, { method:'DELETE' });
await load();
} else if(act==='delphoto'){
await req(`/inventory/${encodeURIComponent(id)}/photo`, { method:'DELETE' });
await load();
}
}catch(e){ alert(e.message); }
});


// --- load
$('#btnLoad').addEventListener('click', load);
</script>
</body>
</html>
